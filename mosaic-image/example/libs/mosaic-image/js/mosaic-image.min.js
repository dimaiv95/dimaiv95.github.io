(function($){$.fn.imageMosaic=function(options){var setting=$.extend({cell:3,marginl:0,marginb:0,response:true},options);return this.each(function(){var that=$(this),image=that.find("img"),tmp=[],cellDefault=setting.cell;image.css({"height":"200px","display":"block"});var h=image.height(),ml=setting.marginl;that.find("a").click(function(){return false});function getWidthImage(){image.each(function(i){tmp[i]=image.eq(i).width()})};function setWidthImage(){if(setting.response){if($(window).width()>992){setting.cell=cellDefault}if($(window).width()<=992){setting.cell=3}if($(window).width()<=480){setting.cell=2}if($(window).width()<=320){setting.cell=1}}var imageArr=[[]],indexArr=0,countImage=1;for(var i=0;i<tmp.length;i++){if(countImage<=setting.cell){imageArr[indexArr][imageArr[indexArr].length]=tmp[i];countImage+=1}else{countImage=2;indexArr+=1;imageArr[indexArr]=new Array();imageArr[indexArr][imageArr[indexArr].length]=tmp[i]}}var WIDTH=that.width(),w=0,rowSum=0,coefficient,imageWidth,imageHeight,eqIndex=0,addWidth,lengthArr=imageArr[0].length;WIDTH=WIDTH-(ml*lengthArr+ml);for(var i=0,len1=imageArr.length;i<len1;i++){for(var j=0,len2=imageArr[i].length;j<len2;j++){rowSum+=imageArr[i][j]}addWidth=(lengthArr-imageArr[i].length)*ml;coefficient=(WIDTH+addWidth)/rowSum;for(var j=0,len2=imageArr[i].length;j<len2;j++){imageHeight=(coefficient*h)-ml;imageWidth=coefficient*imageArr[i][j];image.eq(eqIndex).css({"width":imageWidth+"px","height":imageHeight+"px"});that.children(".mosaic-item").eq(eqIndex).css({"width":imageWidth+"px","height":imageHeight+"px","margin-left":setting.marginl,"margin-bottom":setting.marginb});eqIndex+=1}rowSum=0}};$(window).load(function(){getWidthImage();setWidthImage()}).resize(setWidthImage)})}})(jQuery);